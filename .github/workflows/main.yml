name: VM 16GB Tailscale SSH
on: 
  workflow_dispatch: # Botão manual para iniciar

jobs:
  start-vm:
    # Em repositórios PÚBLICOS, o ubuntu-latest tem 4 cores e ~16GB RAM.
    # Em PRIVADOS, tem apenas 2 cores e 7GB RAM.
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Passo extra só para você confirmar no log que tem 16GB
      - name: Verificar Memória RAM
        run: |
          echo "Verificando hardware..."
          grep MemTotal /proc/meminfo
          free -h

      - name: Conectar ao Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          # O argumento --ssh é essencial para você conseguir entrar na máquina
          args: --ssh 
          # Se você criou a chave com tag, adicione a linha abaixo (remova o #):
          # version: latest

      - name: Manter VM Ativa (Loop)
        timeout-minutes: 360 # Mantém ligado por até 6 horas
        run: |
          echo "VM rodando com 16GB! Conecte-se via: ssh runner@<ip-do-tailscale>"
          # Este loop mantém o processo rodando para o GitHub não matar a VM
          while true; do sleep 30; done
