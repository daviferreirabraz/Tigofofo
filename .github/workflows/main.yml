name: VM 16GB com Tailscale
on: 
  workflow_dispatch: # Permite rodar manualmente

jobs:
  setup_vm:
    # 'ubuntu-latest' em repositórios públicos geralmente fornece 16GB de RAM
    runs-on: ubuntu-latest 

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check RAM
        run: free -h # Comando para confirmar se você tem os 16GB disponíveis

      - name: Conectar ao Tailscale
        uses: tailscale/github-action@v4
        with:
          oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}
          tags: tag:ci # Certifique-se de que esta tag existe no seu Tailscale ACL

      - name: Manter VM Viva
        # Este passo impede que a VM feche imediatamente, permitindo que você acesse via SSH
        run: |
          echo "VM conectada ao Tailscale! Acesse via SSH usando o IP do Tailscale."
          sleep 3600 # Mantém a VM ligada por 1 hora (ajuste conforme necessário)
