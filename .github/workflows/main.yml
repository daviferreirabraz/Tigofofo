name: VM 16GB com VNC e Tailscale
on: 
  workflow_dispatch:

jobs:
  desktop-vm:
    runs-on: ubuntu-latest # 16GB de RAM se o repo for pÃºblico
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Instalar Desktop e VNC
        run: |
          sudo apt update
          # Instala XFCE4 (leve) e o servidor VNC
          sudo apt install -y xfce4 xfce4-goodies tightvncserver
          
          # Configura a senha do VNC (substitua '123456')
          mkdir -p ~/.vnc
          echo "123456" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          
          # Inicia o servidor na porta 5901
          vncserver :1 -geometry 1280x720 -depth 24

      - name: Conectar ao Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Manter Ativa
        run: |
          echo "VNC rodando no IP: $(tailscale ip -4):5901"
          echo "Senha: 123456"
          while true; do sleep 60; done
