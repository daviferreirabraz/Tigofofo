name: Windows 150GB - Direto ao Ponto
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Limpeza Rapida e Rede
        shell: powershell
        run: |
          # Limpa tudo em segundo plano para ir mais rapido
          $folders = @("C:\Program Files\Microsoft Visual Studio", "C:\Microsoft\AndroidSDK", "C:\hostedtoolcache\windows")
          foreach ($f in $folders) { if (Test-Path $f) { cmd /c "rd /s /q $f" } }
          
          # Baixa e liga o Tailscale
          $url = "https://pkgs.tailscale.com/stable/tailscale-setup-latest.exe"
          Invoke-WebRequest -Uri $url -OutFile "ts.exe"
          Start-Process -FilePath ".\ts.exe" -ArgumentList "/S" -Wait
          & "C:\Program Files\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTHKEY }} --accept-routes

      - name: Configurar Acesso Windows App
        shell: powershell
        run: |
          $user = "vovo105"
          $pass = "SenhaForte123!"
          net user $user $pass /add
          net localgroup Administrators $user /add
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

      - name: Instalar Chrome e Manter Online
        shell: powershell
        run: |
          Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
          choco install googlechrome -y
          Write-Host "--- PC PRONTO! ---"
          Write-Host "Usuario: vovo105 | Senha: SenhaForte123!"
          while($true) { Start-Sleep -Seconds 60 }
