name: VM 16GB Grafica VNC
on: 
  workflow_dispatch:

jobs:
  start-vnc:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Instalar Interface Grafica e VNC
        run: |
          sudo apt update
          # Instala o desktop e o servidor VNC
          sudo apt install -y xfce4 xfce4-goodies tightvncserver
          
          # Configura a senha do VNC (serÃ¡ '123456')
          mkdir -p ~/.vnc
          echo "123456" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          
          # Configura a senha do usuario runner (para SSH se precisar)
          echo "runner:123456" | sudo chpasswd
          
          # Inicia o servidor VNC na porta 5901
          vncserver :1 -geometry 1280x720 -depth 24

      - name: Conectar ao Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Manter Ativa
        run: |
          echo "IP da VM: $(tailscale ip -4)"
          echo "Conecte no VNC Viewer usando: IP:1"
          echo "Senha: 123456"
          while true; do sleep 60; done
